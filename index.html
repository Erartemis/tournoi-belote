<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <link href="https://fonts.googleapis.com/css2?family=Creepster&display=swap" rel="stylesheet">
    <title>Tournoi mondial de coinche √† Vancouver</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <style>
    /* ===== Th√®me classique (par d√©faut) ===== */
    :root {
        --accent: #2b7a78;
        --dark: #f4f6f8;
        --light: #222;
        --qualif: #cce8ff;
        --spooky-shadow: none;
    }

    body {
        font-family: 'Segoe UI', Roboto, Arial, sans-serif;
        background: var(--dark);
        margin: 20px;
        color: var(--light);
    }

    header {
        text-align: center;
        margin-bottom: 18px;
        position: relative;
    }

    h1, h2, h3 {
        margin: 0 0 12px;
        color: var(--accent);
        text-align: center;
    }

    h1 {
        font-size: 1.8rem;
    }

    /* Conteneur pour le bouton de basculement */
    .toggle-container {
    text-align: center;
    margin-bottom: 10px;
    }
        
    .theme-toggle {
        padding: 8px 16px;
        background: var(--accent);
        color: white;
        border: none;
        border-radius: 20px;
        cursor: pointer;
        font-weight: bold;
        transition: all 0.3s;
        display: inline-block;
    }


    .theme-toggle:hover {
        transform: scale(1.05);
        box-shadow: 0 0 10px rgba(0, 0, 0, 0.3);
    }

    /* Poules et matchs (th√®me classique) */
    .poules, .matches {
        display: flex;
        flex-wrap: wrap;
        gap: 18px;
        justify-content: center;
    }

    .poule-card, .match-poule-card {
        background: #fff;
        border-radius: 10px;
        padding: 14px;
        width: 320px;
        box-shadow: 0 6px 16px rgba(20, 20, 30, 0.06);
        border: 1px solid #eee;
    }

    .poule-title, .match-poule-title {
        font-weight: 700;
        margin-bottom: 8px;
        font-size: 1.05rem;
        color: #222;
        text-align: center;
    }

    .team-header {
        display: grid;
        grid-template-columns: 1fr 100px 40px;
        gap: 30px;
        align-items: center;
        padding: 6px 10px;
        font-size: 0.8rem;
        color: #888;
        font-weight: 500;
        border-bottom: 1px solid #eee;
        margin-bottom: 4px;
    }

    .team {
        display: grid;
        grid-template-columns: 1fr 100px 60px;
        gap: 8px;
        align-items: center;
        padding: 10px;
        margin: 6px 0;
        border-radius: 8px;
        cursor: pointer;
        transition: all 0.2s;
        background: #fff;
    }

    .team:hover {
        background: #eef9ff;
        transform: translateY(-2px);
    }

    .team .name {
        text-align: left;
        font-weight: 600;
        color: #153243;
    }

    .team .ratio {
        text-align: center;
        font-weight: 700;
    }

    .team .score {
        text-align: right;
        font-weight: 700;
        color: #0b3b2e;
    }

    .victory {
        color: green;
    }

    .defeat {
        color: red;
    }

    .qualified {
        background: var(--qualif);
    }

    .match-container {
        border: 1px solid #eee;
        border-radius: 6px;
        padding: 0;
        margin-bottom: 12px;
        background: #fff;
        position: relative;
        min-height: 80px;
        display: grid;
        grid-template-rows: 1fr 1fr;
    }

    .match-team-row {
        display: grid;
        grid-template-columns: 1fr 100px;
        align-items: center;
        padding: 8px 12px;
    }

    .match-team-name {
        font-weight: normal;
        font-size: 0.95rem;
        justify-self: start;
    }

    .match-team-scores {
        display: grid;
        grid-auto-flow: column;
        gap: 8px;
        color: var(--accent);
        justify-self: end;
        min-width: 100px;
    }

    .match-team-scores span {
        display: inline-block;
        text-align: right;
        min-width: 22px;
    }

    .winning-score {
        font-weight: bold;
    }

    .match-unplayed {
        position: absolute;
        top: 50%;
        right: 12px;
        transform: translateY(-50%);
        color: #ff8c00;
        font-style: italic;
        font-size: 0.9rem;
        font-weight: bold;
    }

    /* Modal */
    .modal {
        display: none;
        position: fixed;
        inset: 0;
        background: rgba(0, 0, 0, 0.5);
        align-items: center;
        justify-content: center;
        z-index: 999;
    }

    .modal .card {
        background: #fff;
        padding: 18px;
        border-radius: 8px;
        width: 320px;
        box-shadow: 0 8px 30px rgba(0, 0, 0, 0.2);
        text-align: center;
    }

    .modal .close {
        float: right;
        cursor: pointer;
        color: #888;
        font-size: 20px;
        font-weight: 700;
    }

    /* ===== Th√®me Halloween ===== */
    .halloween-mode {
        --accent: #ff6b00;
        --dark: #1a1a1a;
        --light: #f4f1de;
        --qualif: #ff9e00;
        --spooky-shadow: 0 0 10px rgba(255, 107, 0, 0.6);
    }

    .halloween-mode body {
        background: var(--dark) url('https://cdn.pixabay.com/photo/2017/10/06/16/50/halloween-background-2822660_960_720.jpg');
        background-size: cover;
        color: var(--light);
    }

    .halloween-mode h1,
    .halloween-mode h2,
    .halloween-mode h3 {
        font-family: 'Creepster', cursive;
        text-shadow: var(--spooky-shadow);
    }

    .halloween-mode h1:after {
        content: " üéÉ";
    }

    .halloween-mode .poule-card,
    .halloween-mode .match-poule-card {
        background: rgba(0, 0, 0, 0.8);
        border-radius: 10px;
        border: 2px solid var(--accent);
        box-shadow: var(--spooky-shadow);
        position: relative;
        overflow: hidden;
    }

    .halloween-mode .poule-card:before,
    .halloween-mode .match-poule-card:before {
        content: "";
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        height: 30px;
        background: url('https://cdn.pixabay.com/photo/2020/10/18/09/59/cobweb-5664560_960_720.png') repeat-x;
        opacity: 0.3;
    }

    .halloween-mode .team-header {
        color: var(--accent);
        border-bottom: 1px solid var(--accent);
    }

    .halloween-mode .team {
        background: rgba(255, 255, 255, 0.05);
    }

    .halloween-mode .team:hover {
        background: rgba(255, 153, 0, 0.1);
        transform: scale(1.02);
    }

    .halloween-mode .team .name {
        color: var(--light);
    }

    .halloween-mode .team .ratio,
    .halloween-mode .team .score {
        color: var(--light);
    }
    .halloween-mode .poule-title,
    .halloween-mode .match-poule-title {
        color: #f96767 !important;
    }

    .halloween-mode #modalPlayers {
        color: #f96767 !important;
    }
        
    .halloween-mode .match-container {
        border: 1px solid var(--accent);
        background: rgba(0, 0, 0, 0.6);
    }

    .halloween-mode .match-team-name {
        color: var(--light);
    }
        
    .halloween-mode .match-team-scores span {
        font-size: 0.9rem !important;
    }

    .halloween-mode .winning-score {
        color: #4CAF50;
        font-size: 1rem;
    }

    .halloween-mode .modal .card {
        background: var(--dark);
        border: 2px solid var(--accent);
        box-shadow: var(--spooky-shadow);
    }

    .halloween-mode .modal .card:before {
        content: "üï∑Ô∏è";
        position: absolute;
        top: -10px;
        right: -10px;
        font-size: 20px;
    }

    .halloween-mode .modal .close {
        color: var(--light);
    }

    /* D√©corations Halloween */
    .halloween-mode body::before {
        content: "üï∏Ô∏è";
        position: fixed;
        top: 10%;
        left: 5%;
        font-size: 30px;
        color: rgba(255, 255, 255, 0.1);
        z-index: -1;
    }

    .halloween-mode body::after {
        content: "üíÄ";
        position: fixed;
        bottom: 15%;
        right: 8%;
        font-size: 24px;
        color: rgba(255, 255, 255, 0.1);
        z-index: -1;
    }
</style>


</head>
<body>
    <header>
        <h1>Tournoi mondial de coinche √† Vancouver</h1>
        <div class="toggle-container">
            <button id="halloweenToggle" class="theme-toggle">Mode Halloween OFF</button>
        </div>
    </header>
    <h2>Poules</h2>
    <div class="poules" id="poules-container"></div>
    <h2>Matchs de poules</h2>
    <div class="matches" id="matches-container"></div>
    <h2>Tableau Final</h2>
    <div class="matches" id="tableau-final-container"></div>

    <!-- Modal -->
    <div id="playerModal" class="modal" role="dialog" aria-modal="true">
        <div class="card">
            <div class="close" id="modalClose">&times;</div>
            <h3 id="modalTeamName"></h3>
            <p id="modalPlayers" style="margin-top: 10px; color: #333; font-weight: 600;"></p>
        </div>
    </div>
    <script>
        const csvEquipes = "https://docs.google.com/spreadsheets/d/e/2PACX-1vTiuPsbbwqM3BRrL4zmmQFl1fGkyLi2j4tPBasqAhZVYYWccSzpMhos5CDIqXeUZR0pJai6S5nLJw1K/pub?gid=1860524493&single=true&output=csv";
        const csvTableau = "https://docs.google.com/spreadsheets/d/e/2PACX-1vTiuPsbbwqM3BRrL4zmmQFl1fGkyLi2j4tPBasqAhZVYYWccSzpMhos5CDIqXeUZR0pJai6S5nLJw1K/pub?gid=760310331&single=true&output=csv";
        const csvMatchesPoules = "https://docs.google.com/spreadsheets/d/e/2PACX-1vTiuPsbbwqM3BRrL4zmmQFl1fGkyLi2j4tPBasqAhZVYYWccSzpMhos5CDIqXeUZR0pJai6S5nLJw1K/pub?gid=285227174&single=true&output=csv";

        function toInt(v) { const n = parseInt((v || "").toString().replace(/[^0-9-]/g, '')); return isNaN(n) ? 0 : n; }

        function afficherPoules(data) {
    const cont = document.getElementById('poules-container');
    cont.innerHTML = "";
    const poules = {};
    data.forEach(r => {
        const pou = r.Poule && r.Poule.toString().trim();
        if (!pou) return;
        if (!poules[pou]) poules[pou] = [];
        poules[pou].push(r);
    });

    // Tri personnalis√© pour chaque poule
    for (const p in poules) {
        poules[p].sort((a, b) => {
            const vicA = toInt(a.Victoires);
            const vicB = toInt(b.Victoires);
            const defA = toInt(a.Defaites);
            const defB = toInt(b.Defaites);
            const manchesA = toInt(a.Manches || a["Manches"] || 0);
            const manchesB = toInt(b.Manches || b["Manches"] || 0);

            // 1. D'abord les √©quipes avec des victoires (par ordre d√©croissant)
            if (vicA > 0 && vicB === 0) return -1;
            if (vicB > 0 && vicA === 0) return 1;
            if (vicA > vicB) return -1;
            if (vicB > vicA) return 1;

            // 2. Ensuite par manches gagn√©es
            if (manchesA > manchesB) return -1;
            if (manchesB > manchesA) return 1;

            // 3. Enfin les √©quipes avec des d√©faites
            if (defA > defB) return 1;
            if (defB > defA) return -1;

            return 0;
        });
    }

    const meilleurs3 = [];
    for (const p in poules) {
        if (poules[p][2]) meilleurs3.push(poules[p][2]);
    }

    meilleurs3.sort((a, b) => toInt(b.Manches || b["Manches"] || 0) - toInt(a.Manches || a["Manches"] || 0));
    const top2trois = meilleurs3.slice(0, 2);

    Object.keys(poules).sort().forEach(p => {
        const card = document.createElement('div');
        card.className = 'poule-card';
        const title = document.createElement('div');
        title.className = 'poule-title';
        title.textContent = "Poule " + p;
        card.appendChild(title);

        const header = document.createElement('div');
        header.className = 'team-header';
        header.innerHTML = `<div>Equipe</div><div style="text-align: center;">Victoires/Defaites</div><div style="text-align: right;">Manches gagnees</div>`;
        card.appendChild(header);

        poules[p].forEach((team, idx) => {
            const div = document.createElement('div');
            div.className = 'team';
            const name = team["Nom de l‚Äô√©quipe"] || team["Nom equipe"] || team["Nom"] || "";
            const vic = team.Victoires || "0";
            const def = team.Defaites || "0";
            const manches = team.Manches || team["Manches"] || "0"; // Utilisation de la colonne Manches

            let medal = "";
            if (idx === 0) medal = "ü•á ";
            else if (idx === 1) medal = "ü•à ";
            else if (idx === poules[p].length - 1 && def > 0) medal = "üíÄ ";
            else if (idx === 2) medal = "ü•â ";

            if (idx < 2 || top2trois.includes(team)) div.classList.add('qualified');
            div.innerHTML = `<div class="name">${medal}${name}</div><div class="ratio"><span class="victory">${vic}</span> / <span class="defeat">${def}</span></div><div class="score">${manches}</div>`;

            div.addEventListener('click', e => {
                e.stopPropagation();
                document.getElementById('modalTeamName').textContent = name;
                const j1 = team["Joueur 1"] || team["Joueur1"] || "";
                const j2 = team["Joueur 2"] || team["Joueur2"] || "";
                document.getElementById('modalPlayers').textContent = [j1, j2].filter(Boolean).join(' & ');
                document.getElementById('playerModal').style.display = 'flex';
            });

            card.appendChild(div);
        });

        cont.appendChild(card);
    });
}


        function afficherMatchesPoules(data) {
            const cont = document.getElementById('matches-container');
            cont.innerHTML = "";

            // Organiser les matchs par poule
            const matchsParPoule = {};
            data.forEach(match => {
                const poule = match.Poule || "Inconnue";
                if (!matchsParPoule[poule]) matchsParPoule[poule] = [];
                matchsParPoule[poule].push(match);
            });

            // Cr√©er une carte par poule
            for (const [poule, matchs] of Object.entries(matchsParPoule)) {
                const pouleCard = document.createElement('div');
                pouleCard.className = 'match-poule-card';

                const title = document.createElement('div');
                title.className = 'match-poule-title';
                title.textContent = `Poule ${poule}`;
                pouleCard.appendChild(title);

                matchs.forEach(match => {
                    const teamA = match["√âquipe A"] || match["Equipe A"] || "√âquipe Inconnue";
                    const teamB = match["√âquipe B"] || match["Equipe B"] || "√âquipe Inconnue";

                    // Scores des parties
                    const scoreA1 = toInt(match["Partie 1-score A"]);
                    const scoreA2 = toInt(match["Partie 2-score A"]);
                    const scoreA3 = toInt(match["Partie 3-score A"]);
                    const scoreB1 = toInt(match["Partie 1-score B"]);
                    const scoreB2 = toInt(match["Partie 2-score B"]);
                    const scoreB3 = toInt(match["Partie 3-score B"]);

                    const isUnplayed = (scoreA1 === 0 && scoreB1 === 0 && scoreA2 === 0 && scoreB2 === 0 && scoreA3 === 0 && scoreB3 === 0);

                    // Calcul des scores totaux
                    const totalScoreA = scoreA1 + scoreA2 + scoreA3;
                    const totalScoreB = scoreB1 + scoreB2 + scoreB3;

                    // Cr√©er le conteneur du match
                    const matchContainer = document.createElement('div');
                    matchContainer.className = 'match-container';
                    matchContainer.style.position = 'relative';

                    // √âquipe A (en haut)
                    const teamARow = document.createElement('div');
                    teamARow.className = 'match-team-row';

                    const teamAName = document.createElement('div');
                    teamAName.className = 'match-team-name';
                    teamAName.textContent = teamA;

                    const teamAScores = document.createElement('div');
                    teamAScores.className = 'match-team-scores';

                    if (!isUnplayed) {
                        // Partie 1
                        const scoreA1Span = document.createElement('span');
                        scoreA1Span.textContent = scoreA1;
                        if (scoreA1 > scoreB1) scoreA1Span.classList.add('winning-score');
                        teamAScores.appendChild(scoreA1Span);

                        // Partie 2
                        if (scoreA2 > 0 || scoreB2 > 0) {
                            const separator = document.createElement('span');
                            separator.textContent = ' ';
                            teamAScores.appendChild(separator);

                            const scoreA2Span = document.createElement('span');
                            scoreA2Span.textContent = scoreA2;
                            if (scoreA2 > scoreB2) scoreA2Span.classList.add('winning-score');
                            teamAScores.appendChild(scoreA2Span);
                        }

                        // Partie 3
                        if (scoreA3 > 0 || scoreB3 > 0) {
                            const separator = document.createElement('span');
                            separator.textContent = ' ';
                            teamAScores.appendChild(separator);

                            const scoreA3Span = document.createElement('span');
                            scoreA3Span.textContent = scoreA3;
                            if (scoreA3 > scoreB3) scoreA3Span.classList.add('winning-score');
                            teamAScores.appendChild(scoreA3Span);
                        }
                    }

                    teamARow.appendChild(teamAName);
                    teamARow.appendChild(teamAScores);
                    matchContainer.appendChild(teamARow);

                    // √âquipe B (en bas)
                    const teamBRow = document.createElement('div');
                    teamBRow.className = 'match-team-row';

                    const teamBName = document.createElement('div');
                    teamBName.className = 'match-team-name';
                    teamBName.textContent = teamB;

                    const teamBScores = document.createElement('div');
                    teamBScores.className = 'match-team-scores';

                    if (!isUnplayed) {
                        // Partie 1
                        const scoreB1Span = document.createElement('span');
                        scoreB1Span.textContent = scoreB1;
                        if (scoreB1 > scoreA1) scoreB1Span.classList.add('winning-score');
                        teamBScores.appendChild(scoreB1Span);

                        // Partie 2
                        if (scoreA2 > 0 || scoreB2 > 0) {
                            const separator = document.createElement('span');
                            separator.textContent = ' ';
                            teamBScores.appendChild(separator);

                            const scoreB2Span = document.createElement('span');
                            scoreB2Span.textContent = scoreB2;
                            if (scoreB2 > scoreA2) scoreB2Span.classList.add('winning-score');
                            teamBScores.appendChild(scoreB2Span);
                        }

                        // Partie 3
                        if (scoreA3 > 0 || scoreB3 > 0) {
                            const separator = document.createElement('span');
                            separator.textContent = ' ';
                            teamBScores.appendChild(separator);

                            const scoreB3Span = document.createElement('span');
                            scoreB3Span.textContent = scoreB3;
                            if (scoreB3 > scoreA3) scoreB3Span.classList.add('winning-score');
                            teamBScores.appendChild(scoreB3Span);
                        }
                    }

                    teamBRow.appendChild(teamBName);
                    teamBRow.appendChild(teamBScores);
                    matchContainer.appendChild(teamBRow);

                    // Mettre en gras le nom du gagnant
                    if (!isUnplayed) {
                        // Utiliser la colonne "Vainqueur" pour d√©terminer le gagnant
                        const vainqueur = match["Vainqueur"] || match["vainqueur"] || "";

                        if (vainqueur === teamA) {
                            teamAName.style.fontWeight = 'bold';
                        } else if (vainqueur === teamB) {
                            teamBName.style.fontWeight = 'bold';
                        }
                        // Si Vainqueur est vide ou ne correspond √† aucune √©quipe, on ne met rien en gras
                    } else {
                        // Ajouter "Match √† jouer" centr√© verticalement
                        const unplayed = document.createElement('div');
                        unplayed.className = 'match-unplayed';
                        unplayed.textContent = "Match √† jouer";
                        matchContainer.appendChild(unplayed);
                    }

                    pouleCard.appendChild(matchContainer);
                });

                cont.appendChild(pouleCard);
            }
        }

        function remplirTableauFinal(data) {
    const cont = document.getElementById('tableau-final-container');
    cont.innerHTML = "";

    // Filtrer les matchs des quarts de finale
    const quartsDeFinale = data.filter(row => row.Phase && row.Phase.includes("Quart"));

    // Cr√©er une carte pour les quarts de finale
    const quartCard = document.createElement('div');
    quartCard.className = 'match-poule-card';

    const title = document.createElement('div');
    title.className = 'match-poule-title';
    title.textContent = "Quarts de Finale";
    quartCard.appendChild(title);

    quartsDeFinale.forEach(match => {
        const teamA = match['√âquipe A'] || match['Equipe A'] || "√âquipe Inconnue";
        const teamB = match['√âquipe B'] || match['Equipe B'] || "√âquipe Inconnue";

        // Scores des parties
        const scoreA = toInt(match['Score A'] || 0);
        const scoreB = toInt(match['Score B'] || 0);

        // Cr√©er le conteneur du match
        const matchContainer = document.createElement('div');
        matchContainer.className = 'match-container';

        // √âquipe A (en haut)
        const teamARow = document.createElement('div');
        teamARow.className = 'match-team-row';

        const teamAName = document.createElement('div');
        teamAName.className = 'match-team-name';
        teamAName.textContent = teamA;

        const teamAScores = document.createElement('div');
        teamAScores.className = 'match-team-scores';

        const scoreASpan = document.createElement('span');
        scoreASpan.textContent = scoreA;
        teamAScores.appendChild(scoreASpan);

        teamARow.appendChild(teamAName);
        teamARow.appendChild(teamAScores);
        matchContainer.appendChild(teamARow);

        // √âquipe B (en bas)
        const teamBRow = document.createElement('div');
        teamBRow.className = 'match-team-row';

        const teamBName = document.createElement('div');
        teamBName.className = 'match-team-name';
        teamBName.textContent = teamB;

        const teamBScores = document.createElement('div');
        teamBScores.className = 'match-team-scores';

        const scoreBSpan = document.createElement('span');
        scoreBSpan.textContent = scoreB;
        teamBScores.appendChild(scoreBSpan);

        teamBRow.appendChild(teamBName);
        teamBRow.appendChild(teamBScores);
        matchContainer.appendChild(teamBRow);

        // Mettre en gras le nom du gagnant
        const vainqueur = match['Vainqueur'] || match['vainqueur'] || "";
        if (vainqueur === teamA) {
            teamAName.style.fontWeight = 'bold';
        } else if (vainqueur === teamB) {
            teamBName.style.fontWeight = 'bold';
        }

        quartCard.appendChild(matchContainer);
    });

    cont.appendChild(quartCard);
}



        document.getElementById('modalClose').addEventListener('click', () => document.getElementById('playerModal').style.display = 'none');
        window.addEventListener('click', e => { if (e.target === document.getElementById('playerModal')) document.getElementById('playerModal').style.display = 'none'; });

        Papa.parse(csvEquipes, { download: true, header: true, complete: r => afficherPoules(r.data) });
        Papa.parse(csvMatchesPoules, { download: true, header: true, complete: r => afficherMatchesPoules(r.data) });
        Papa.parse(csvTableau, { download: true, header: true, complete: r => remplirTableauFinal(r.data) });
        const toggleButton = document.getElementById('halloweenToggle');
        
        document.addEventListener('DOMContentLoaded', function() {
                const toggleButton = document.getElementById('halloweenToggle');
                toggleButton.addEventListener('click', function(event) {
                    event.preventDefault(); // Emp√™che tout comportement par d√©faut
                    document.body.classList.toggle('halloween-mode');
                    const isHalloween = document.body.classList.contains('halloween-mode');
                    toggleButton.textContent = isHalloween ? 'Mode Halloween ON' : 'Mode Halloween OFF';

                    if (isHalloween && !document.getElementById('creepster-font')) {
                        const fontLink = document.createElement('link');
                        fontLink.id = 'creepster-font';
                        fontLink.href = 'https://fonts.googleapis.com/css2?family=Creepster&display=swap';
                        fontLink.rel = 'stylesheet';
                        document.head.appendChild(fontLink);
                    }
                });
        });
    </script>
</body>
</html>
