<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>Tournoi mondial de coinche Ã  Vancouver</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"></script>
<meta name="viewport" content="width=device-width,initial-scale=1">
<style>
  :root{
    --accent:#2b7a78;
    --qualif:#cce8ff;
  }
  body { font-family: 'Segoe UI', Roboto, Arial, sans-serif; background: #f4f6f8; margin: 20px; color:#222; }
  header { text-align:center; margin-bottom:18px; }
  h1 { margin:0; font-size:1.8rem; color:var(--accent); }
  h2 { margin: 24px 0 12px; color:#333; text-align:center; }

  /* Poules */
  .poules { display:flex; flex-wrap:wrap; gap:18px; justify-content:center; }
  .poule-card {
    background:#fff; border-radius:10px; padding:14px; width:320px;
    box-shadow:0 6px 16px rgba(20,20,30,0.06);
  }
  .poule-title { font-weight:700; margin-bottom:8px; font-size:1.05rem; color:#222; text-align:center; }
  .team {
    display:grid; grid-template-columns: 1fr 90px 70px; gap:8px; align-items:center;
    padding:10px; margin:6px 0; border-radius:8px; cursor:pointer;
    transition: background .16s, transform .12s;
  }
  .team:hover{ background: #eef9ff; transform: translateY(-2px); }
  .team .name { text-align:left; font-weight:600; color:#153243; }
  .team .ratio { text-align:center; font-weight:700; }
  .team .score { text-align:right; font-weight:700; color:#0b3b2e; }
  .victory { color:green; }
  .defeat { color:red; }

  .qualified { background:var(--qualif); }

  /* Matches poules */
  .matches { max-width:980px; margin:0 auto 18px; background:#fff; padding:12px; border-radius:8px; box-shadow:0 6px 14px rgba(10,10,20,0.04); }
  .match-row { display:flex; justify-content:flex-start; gap:12px; padding:8px 6px; border-bottom:1px solid #eee; align-items:center; }
  .match-row:last-child{ border-bottom:0; }
  .match-phase { font-size:.9rem; color:#666; min-width:80px; text-align:left; }
  .match-desc { font-weight:600; }

  /* Tableau final */
  .table-wrapper { max-width:1200px; margin:0 auto; }
  table { width:100%; border-collapse:collapse; background:#fff; border-radius:8px; overflow:hidden; box-shadow:0 6px 14px rgba(10,10,20,0.04); }
  th, td { padding:10px 12px; border-bottom:1px solid #eee; text-align:center; font-size:0.95rem; }
  th { background:var(--accent); color:#fff; font-weight:700; }
  tr:hover td { background:#fafafa; }
  .winner { background:#dfffe0 !important; font-weight:700; }

  /* modal */
  .modal { display:none; position:fixed; inset:0; background:rgba(0,0,0,0.5); align-items:center; justify-content:center; z-index:999; }
  .modal .card { background:#fff; padding:18px; border-radius:8px; width:320px; box-shadow:0 8px 30px rgba(0,0,0,0.2); text-align:center; }
  .modal .close { float:right; cursor:pointer; color:#888; font-size:20px; font-weight:700; }

</style>
</head>
<body>
<header>
  <h1>Tournoi mondial de belote Ã  Vancouver</h1>
</header>

<h2>Poules</h2>
<div class="poules" id="poules-container"></div>

<h2>Matchs de poules</h2>
<div class="matches" id="matches-container"></div>

<div id="tableFinalSection" style="display:none">
  <h2>Tableau Final</h2>
  <div id="tableFinalWrapper" class="table-wrapper">
    <table id="tableauFinal">
      <thead>
        <tr><th>Phase</th><th>Match</th><th>Ã‰quipe A</th><th>Ã‰quipe B</th><th>Score A</th><th>Score B</th><th>Vainqueur</th></tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>
</div>

<!-- Modal -->
<div id="playerModal" class="modal" role="dialog" aria-modal="true">
  <div class="card">
    <div class="close" id="modalClose">&times;</div>
    <h3 id="modalTeamName"></h3>
    <p id="modalPlayers" style="margin-top:10px;color:#333;font-weight:600"></p>
  </div>
</div>

<script>
const csvEquipes = "https://docs.google.com/spreadsheets/d/e/2PACX-1vTiuPsbbwqM3BRrL4zmmQFl1fGkyLi2j4tPBasqAhZVYYWccSzpMhos5CDIqXeUZR0pJai6S5nLJw1K/pub?gid=1860524493&single=true&output=csv";
const csvTableau = "https://docs.google.com/spreadsheets/d/e/2PACX-1vTiuPsbbwqM3BRrL4zmmQFl1fGkyLi2j4tPBasqAhZVYYWccSzpMhos5CDIqXeUZR0pJai6S5nLJw1K/pub?gid=760310331&single=true&output=csv";
const csvMatchesPoules = "https://docs.google.com/spreadsheets/d/e/2PACX-1vTiuPsbbwqM3BRrL4zmmQFl1fGkyLi2j4tPBasqAhZVYYWccSzpMhos5CDIqXeUZR0pJai6S5nLJw1K/pub?gid=285227174&single=true&output=csv";

function toInt(v){ const n=parseInt((v||"").toString().replace(/[^0-9-]/g,'')); return isNaN(n)?0:n; }

function afficherPoules(data){
  const cont = document.getElementById('poules-container');
  cont.innerHTML = "";
  const poules={};
  data.forEach(r=>{
    const pou = r.Poule && r.Poule.toString().trim();
    if(!pou) return;
    if(!poules[pou]) poules[pou]=[];
    poules[pou].push(r);
  });

  const meilleurs3=[];
  for(const p in poules){
    poules[p].sort((a,b)=>{
      const va=toInt(a.Victoires), vb=toInt(b.Victoires);
      if(vb!==va) return vb-va;
      return toInt(b["Score total"])-toInt(a["Score total"]);
    });
    if(poules[p][2]) meilleurs3.push(poules[p][2]);
  }
  meilleurs3.sort((a,b)=>toInt(b["Score total"])-toInt(a["Score total"]));
  const top2trois=meilleurs3.slice(0,2);

  Object.keys(poules).sort().forEach(p=>{
    const card=document.createElement('div'); card.className='poule-card';
    const title=document.createElement('div'); title.className='poule-title'; title.textContent="Poule "+p;
    card.appendChild(title);

    poules[p].forEach((team, idx)=>{
      const div=document.createElement('div'); div.className='team';
      const name=team["Nom de lâ€™Ã©quipe"]||team["Nom Ã©quipe"]||team["Nom"]||"";
      const vic=team["Victoires"]||"0";
      const def=team["Defaites"]||"0";
      const score=team["Score total"]||"0";

      // emoji classement
      let medal="";
      if(idx===0) medal="ðŸ¥‡ ";
      else if(idx===1) medal="ðŸ¥ˆ ";
      else if(idx===2) medal="ðŸ¥‰ ";
      else if(idx===3) medal="ðŸ’€ ";

      if(idx<2 || top2trois.includes(team)) div.classList.add('qualified');

      div.innerHTML=`<div class="name">${medal}${name}</div>
                     <div class="ratio"><span class="victory">${vic}</span> / <span class="defeat">${def}</span></div>
                     <div class="score">${score}</div>`;

      div.addEventListener('click', e=>{
        e.stopPropagation();
        document.getElementById('modalTeamName').textContent=name;
        const j1=team["Joueur 1"]||team["Joueur1"]||"";
        const j2=team["Joueur 2"]||team["Joueur2"]||"";
        document.getElementById('modalPlayers').textContent=[j1,j2].filter(Boolean).join(' & ');
        document.getElementById('playerModal').style.display='flex';
      });
      card.appendChild(div);
    });
    cont.appendChild(card);
  });
}

let tousMatchsJoues=true;
function afficherMatchesPoules(data){
  const cont = document.getElementById('matches-container');
  cont.innerHTML = "";
  let tousMatchsJoues = true;

  /* ---------- regroupement par poule ---------- */
  const poules = { A:[], B:[], C:[] };
  data.forEach(row=>{
    if(!Object.values(row).some(v=>v)) return;
    const phase = (row.Phase||'').toUpperCase();
    let cle = '';
    if(phase.includes('A')) cle='A';
    else if(phase.includes('B')) cle='B';
    else if(phase.includes('C')) cle='C';
    if(cle) poules[cle].push(row);
  });

  /* ---------- affichage ---------- */
  ['A','B','C'].forEach(p=>{
    const liste = poules[p];
    if(!liste.length) return;

    /* sÃ©parer jouÃ©s / Ã  jouer */
    const joues   = liste.filter(r=> toInt(r["Score A"])!==0 || toInt(r["Score B"])!==0 );
    const aJouer  = liste.filter(r=> toInt(r["Score A"])===0 && toInt(r["Score B"])===0 );
    if(aJouer.length) tousMatchsJoues = false;

    /* titre poule */
    const titre = document.createElement('h3');
    titre.textContent = `Poule ${p}`;
    cont.appendChild(titre);

    /* matchs jouÃ©s dâ€™abord */
    [...joues, ...aJouer].forEach(row=>{
      const teamA = row["Ã‰quipe A"] || row["Equipe A"] || "";
      const teamB = row["Ã‰quipe B"] || row["Equipe B"] || "";
      const sa    = toInt(row["Score A"]);
      const sb    = toInt(row["Score B"]);

      const container = document.createElement('div'); container.className = 'match-row';
      const phase     = document.createElement('div'); phase.className = 'match-phase'; phase.textContent = row.Phase||"";
      const desc      = document.createElement('div'); desc.className  = 'match-desc';

      if(sa===0 && sb===0){
        desc.innerHTML = `${teamA} (0) â€” (0) ${teamB} <span style="color:#b5651d;font-weight:700;margin-left:8px;">(Match Ã  jouer)</span>`;
      }else if(sa > sb){
        desc.innerHTML = `<strong>${teamA}</strong> (${sa}) â€” (${sb}) ${teamB}`;
      }else if(sb > sa){
        desc.innerHTML = `${teamA} (${sa}) â€” (${sb}) <strong>${teamB}</strong>`;
      }else{
        desc.innerHTML = `${teamA} (${sa}) â€” (${sb}) ${teamB} <em style="margin-left:8px;color:#666">(Ã‰galitÃ©)</em>`;
      }

      container.appendChild(phase);
      container.appendChild(desc);
      cont.appendChild(container);
    });
  });

  /* affichage/masquage tableau final */
  document.getElementById('tableFinalSection').style.display = tousMatchsJoues ? 'block' : 'none';
}

function remplirTableauFinal(data){
  const tbody=document.querySelector('#tableauFinal tbody');
  tbody.innerHTML="";
  data.forEach(row=>{
    if(!Object.values(row).some(v=>v)) return;
    const tr=document.createElement('tr');
    const cols=["Phase","Match","Ã‰quipe A","Ã‰quipe B","Score A","Score B","Vainqueur"];
    tr.innerHTML=cols.map(c=>{
      let v=row[c]||row[c.replace('Ã‰','E')]||"";
      return `<td${(c==="Vainqueur" && v)?' class="winner"':''}>${v}</td>`;
    }).join("");
    tbody.appendChild(tr);
  });
}

document.getElementById('modalClose').addEventListener('click', ()=>document.getElementById('playerModal').style.display='none');
window.addEventListener('click', e=>{ if(e.target===document.getElementById('playerModal')) document.getElementById('playerModal').style.display='none'; });

Papa.parse(csvEquipes,{download:true,header:true,complete:r=>afficherPoules(r.data)});
Papa.parse(csvMatchesPoules,{download:true,header:true,complete:r=>afficherMatchesPoules(r.data)});
Papa.parse(csvTableau,{download:true,header:true,complete:r=>remplirTableauFinal(r.data)});
</script>
</body>
</html>


