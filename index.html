<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Tournoi mondial de belote Ã  Vancouver</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 20px;
      background: #f4f6f9;
    }
    h1 {
      text-align: center;
      color: #2c3e50;
    }
    .section {
      margin-top: 30px;
      padding: 20px;
      background: #fff;
      border-radius: 10px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.1);
    }
    h2 {
      border-bottom: 2px solid #2c3e50;
      padding-bottom: 8px;
      margin-bottom: 15px;
      text-align: center;
    }
    .poule {
      margin-bottom: 30px;
    }
    .poule h3 {
      background: #3498db;
      color: white;
      padding: 10px;
      border-radius: 5px;
      margin: 0;
      text-align: center; /* centre le texte */
    }
    .team {
      display: flex;
      justify-content: space-between;
      padding: 8px 12px;
      border-bottom: 1px solid #ddd;
      background: #f9f9f9;
    }
    .team:nth-child(even) {
      background: #eef3f7;
    }
    .highlight {
      background: #d6eaff !important;
      font-weight: bold;
    }
    .ratio span {
      margin: 0 3px;
    }
    .green { color: green; font-weight: bold; }
    .red { color: red; font-weight: bold; }
    .match {
      padding: 8px 12px;
      border-bottom: 1px solid #ddd;
      background: #fff;
    }
    .match:nth-child(even) {
      background: #f2f6fa;
    }
    .bold {
      font-weight: bold;
    }
  </style>
</head>
<body>
  <h1>Tournoi mondial de belote Ã  Vancouver</h1>

  <div class="section" id="poules">
    <h2>Classements des poules</h2>
    <div id="poules-container"></div>
  </div>

  <div class="section" id="matchs-poules">
    <h2>Matchs de poules</h2>
    <div id="matchs-poules-container"></div>
  </div>

  <div class="section" id="finals" style="display:none;">
    <h2>Tableau final</h2>
    <div id="finals-container"></div>
  </div>

  <script>
    const equipesUrl = "https://docs.google.com/spreadsheets/d/e/2PACX-1vTiuPsbbwqM3BRrL4zmmQFl1fGkyLi2j4tPBasqAhZVYYWccSzpMhos5CDIqXeUZR0pJai6S5nLJw1K/pub?gid=1860524493&single=true&output=csv";
    const poulesUrl = "https://docs.google.com/spreadsheets/d/e/2PACX-1vTiuPsbbwqM3BRrL4zmmQFl1fGkyLi2j4tPBasqAhZVYYWccSzpMhos5CDIqXeUZR0pJai6S5nLJw1K/pub?gid=285227174&single=true&output=csv";
    const finalUrl = "https://docs.google.com/spreadsheets/d/e/2PACX-1vTiuPsbbwqM3BRrL4zmmQFl1fGkyLi2j4tPBasqAhZVYYWccSzpMhos5CDIqXeUZR0pJai6S5nLJw1K/pub?gid=760310331&single=true&output=csv";

    async function fetchCSV(url) {
      const res = await fetch(url);
      const text = await res.text();
      return text.split("\n").map(r => r.split(","));
    }

    function displayPoules(data) {
      const container = document.getElementById("poules-container");
      const headers = data[0];
      const rows = data.slice(1);

      const poules = {};
      rows.forEach(r => {
        if (!r[0]) return;
        const team = {
          nom: r[1],
          joueur1: r[2],
          joueur2: r[3],
          poule: r[4],
          score: r[5],
          victoires: r[6],
          defaites: r[7],
          classement: r[9]
        };
        if (!poules[team.poule]) poules[team.poule] = [];
        poules[team.poule].push(team);
      });

      Object.keys(poules).forEach(poule => {
        const div = document.createElement("div");
        div.className = "poule";
        div.innerHTML = `<h3>Poule ${poule}</h3>`;
        poules[poule].forEach(t => {
          let medal = "ðŸ’€";
          if (t.classement === "1") medal = "ðŸ¥‡";
          else if (t.classement === "2") medal = "ðŸ¥ˆ";
          else if (t.classement === "3") medal = "ðŸ¥‰";

          div.innerHTML += `
            <div class="team ${t.classement <= 3 ? "highlight" : ""}">
              <span>${medal} ${t.nom}</span>
              <span class="ratio">
                <span class="green">${t.victoires}</span> -
                <span class="red">${t.defaites}</span>
              </span>
              <span>${t.score}</span>
            </div>
          `;
        });
        container.appendChild(div);
      });
    }

    function displayPoulesMatches(data) {
      const container = document.getElementById("matchs-poules-container");
      const rows = data.slice(1);
      rows.forEach(r => {
        if (!r[0]) return;
        const eqA = r[0], eqB = r[2];
        const scA = parseInt(r[3]) || 0;
        const scB = parseInt(r[4]) || 0;
        let display;

        if (scA === 0 && scB === 0) {
          display = "Match Ã  jouer";
        } else {
          const boldA = scA > scB ? "bold" : "";
          const boldB = scB > scA ? "bold" : "";
          display = `<span class="${boldA}">${eqA} ${scA}</span> - <span class="${boldB}">${scB} ${eqB}</span>`;
        }

        container.innerHTML += `<div class="match">${display}</div>`;
      });
    }

    function displayFinals(data, pouleMatches) {
      const container = document.getElementById("finals-container");
      const rows = data.slice(1);

      // VÃ©rifier si tous les matchs de poules ont Ã©tÃ© jouÃ©s
      const pouleLeft = pouleMatches.slice(1).some(r => (parseInt(r[3]) || 0) === 0 && (parseInt(r[4]) || 0) === 0);
      if (pouleLeft) return;

      document.getElementById("finals").style.display = "block";

      rows.forEach(r => {
        if (!r[0]) return;
        const phase = r[0], eqA = r[2], eqB = r[3];
        const scA = parseInt(r[4]) || 0;
        const scB = parseInt(r[5]) || 0;
        let display;

        if (scA === 0 && scB === 0) {
          display = "Match Ã  jouer";
        } else {
          const boldA = scA > scB ? "bold" : "";
          const boldB = scB > scA ? "bold" : "";
          display = `<span class="${boldA}">${eqA} ${scA}</span> - <span class="${boldB}">${scB} ${eqB}</span>`;
        }

        container.innerHTML += `<div class="match"><strong>${phase}</strong>: ${display}</div>`;
      });
    }

    async function init() {
      const equipes = await fetchCSV(equipesUrl);
      const poules = await fetchCSV(poulesUrl);
      const finals = await fetchCSV(finalUrl);

      displayPoules(equipes);
      displayPoulesMatches(poules);
      displayFinals(finals, poules);
    }

    init();
  </script>
</body>
</html>
